<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hellper Catalogue Book</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../Style/book_page.css">
    <link rel="stylesheet" href="../Style/mobile.css">
    <link rel="stylesheet" href="../Style/theme_mods.css">

    <script type='text/javascript'
        src='https://platform-api.sharethis.com/js/sharethis.js#property=65a54943fbfe1600199c5bfb&product=sop'
        async='async'></script>
    <link rel="icon" href="../media/image/FavIcon.png" type="image/x-icon">
    <link rel="shortcut icon" href="../media/image/FavIcon.png" type="image/x-icon">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/vfs_fonts.js"></script>


</head>

<body class="light-mode">
    <div class="container">
        <div class="header" id="header">
            <div class="header_left">
                <a href="https://javiddogroup.github.io/Brake-Pad-Catalog/Pages/Flip.html">
                    <img id="light-image" class="theme-image light-theme" src="../media/image/white-mode.png"
                        alt="Light Image">
                    <img id="dark-image" class="theme-image dark-theme" src="../media/image/dark-mode.png"
                        alt="Dark Image">
                </a>
            </div>
            <div class="header_right">
                <p class="spare_parts_name">BRAKE PAD</p>
                <img class="spare_parts_picture" src="../media/image/Spare Parts.png" alt="">
            </div>
        </div>

        <div class="catalog"><iframe id="zoom_iframe" style="width: 59.9%; height: 700px;"
                src="https://online.anyflip.com/xjawo/hvbk/index.html" frameborder="0" scrolling="no"
                seamless="seamless" allowfullscreen="allowfullscreen"></iframe></div>






        <div class="page_up"><a style="transition: 10s; margin: auto;" href="#top"><img src="../media/svg/page_up.svg"
                    alt="Page Up Hellper Javiddo"></a>
        </div>
        <div class="red_line"></div>
        <div class="footer">

            <div class="footer_left">
                <a class="left_nav_bar" href="https://javiddogroup.github.io/Brake-Pad-Catalog/">
                    <img src="../media/svg/LeftArrow.svg" alt="Back Page Hellper Javiddo Spare Parts">
                </a>
                <a class="left_nav_bar" href="https://www.javiddo.com/p/catalog">
                    <img src="../media/svg/HomePage.svg" alt="Home Page Hellper Javiddo Spare Parts">
                </a>
                <a class="left_nav_bar" href="./book.html">
                    <img src="../media/svg/Book.svg" alt="Book Page Hellper Javiddo Spare Parts">
                </a>
            </div>
            <div class="footer_center">
                <button class="toggle-button" onclick="toggleTheme()">
                    <img style="cursor: pointer;" id="light-image" class="theme-image light-theme"
                        src="../media/image/Moon.png" alt="Light Image">
                    <img style="cursor: pointer;" id="dark-image" class="theme-image dark-theme"
                        src="../media/image/Sun.png" alt="Dark Image">
                </button>
            </div>

            <div class="footer_right">
                <a href="./tour.html" class="right_nav_bar">
                    <img class="mini_icon" style="width: 27px;" src="../media/svg/360-degrees.svg"
                        alt="360 Room Tour Javiddo Hellper Spare Part">
                </a>
                <a href="https://www.javiddo.com/contact" class="right_nav_bar">
                    <img src="../media/svg/Phone.svg" alt="Contact Us Javiddo Hellper Spare Part">
                </a>

                <a style="cursor: pointer;" onclick="convertExcelToPDF()" class="right_nav_bar">
                    <img src="../media/svg/Download.svg" alt="Download Javiddo Hellper Spare Part">
                </a>
            </div>
        </div>
        <script src="../script.js"></script>
        <script>
            async function convertExcelToPDF() {
                var excelFilePath = '../DataBase/TestDataBase.xlsx';
                var reader = new FileReader();

                reader.onload = async function (e) {
                    try {
                        var data = new Uint8Array(e.target.result);
                        var workbook = XLSX.read(data, { type: 'array' });
                        var firstSheetName = workbook.SheetNames[0];
                        var ws = workbook.Sheets[firstSheetName];
                        var jsonData = XLSX.utils.sheet_to_json(ws, { header: 1 });

                        // Обработка данных
                        var cleanedData = removeEmptyCells(jsonData);

                        // Генерация PDF
                        var watermark = await createWatermarkBase64();
                        var pdfDoc = {
                            content: [
                                {
                                    table: {
                                        headerRows: 1,
                                        body: cleanedData.map(row => row.map(cell => {
                                            return {
                                                text: cell,
                                                alignment: 'center',
                                                lineHeight: 1.2,
                                                margin: [5, 10],
                                                noWrap: true
                                            };
                                        })),
                                        widths: Array(cleanedData[0].length).fill('*'),
                                        alignment: 'center'
                                    },
                                    layout: 'lightHorizontalLines'
                                }
                            ],
                            background: watermark,
                            pageMargins: [50, 50, 50, 50],
                            pageSize: 'A4',
                            pageOrientation: 'portrait',
                            pagePaddings: [0, 30],
                        };

                        pdfMake.createPdf(pdfDoc).download("converted_data.pdf");
                    } catch (error) {
                        console.error('Error processing Excel data:', error);
                    }
                };

                try {
                    var response = await fetch(excelFilePath);
                    var buffer = await response.arrayBuffer();
                    reader.readAsArrayBuffer(new Blob([buffer]));
                } catch (error) {
                    console.error('Error fetching the Excel file:', error);
                }
            }

            function removeEmptyCells(jsonData) {
                var cleanedData = jsonData.map(row => row.filter(cell => cell !== undefined && cell !== null && cell !== ''));
                var maxCells = Math.max(...cleanedData.map(row => row.length));

                cleanedData = cleanedData.map(row => {
                    var diff = maxCells - row.length;
                    if (diff > 0) {
                        return row.concat(Array(diff).fill(''));
                    }
                    return row;
                });

                return cleanedData;
            }

            function createWatermarkBase64() {
                var imagePath = '../media/image/WaterMark.png';
                var img = new Image();
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');

                return new Promise((resolve, reject) => {
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0, img.width, img.height);
                        var dataURL = canvas.toDataURL('image/png');
                        resolve({ image: dataURL, width: 500, height: 500, absolutePosition: { x: 50, y: 250 }, opacity: 0.1 });
                    };

                    img.onerror = function (error) {
                        reject(error);
                    };

                    img.src = imagePath;
                });
            }
        </script>
    </div>
</body>

</html>