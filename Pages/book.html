<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hellper Catalogue Book</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../Style/book_page.css">
    <link rel="stylesheet" href="../Style/mobile.css">
    <link rel="stylesheet" href="../Style/theme_mods.css">

    <script type='text/javascript'
        src='https://platform-api.sharethis.com/js/sharethis.js#property=65a54943fbfe1600199c5bfb&product=sop'
        async='async'></script>
    <link rel="icon" href="../media/image/FavIcon.png" type="image/x-icon">
    <link rel="shortcut icon" href="../media/image/FavIcon.png" type="image/x-icon">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.71/vfs_fonts.js"></script>


</head>

<body body class="light-mode">
    <div class="container">
        <div class="header" id="header">
            <div class="header_left">
                <a href="https://www.javiddo.com/p/hellper">
                    <img id="light-image" class="theme-image light-theme" src="../media/image/white-mode.png"
                        alt="Light Image">
                    <img id="dark-image" class="theme-image dark-theme" src="../media/image/dark-mode.png"
                        alt="Dark Image">
                </a>
            </div>
            <div class="header_right">
                <p class="spare_parts_name">BRAKE PAD</p>
                <img class="spare_parts_picture" src="../media/image/Spare Parts.png" alt="">
            </div>
        </div>

        <div class="catalog"><iframe style="width: 59.9%; height: 700px;"
                src="https://online.anyflip.com/xjawo/hvbk/index.html" frameborder="0" scrolling="no"
                seamless="seamless" allowfullscreen="allowfullscreen"></iframe></div>






        <div class="page_up"><a style="transition: 10s; margin: auto;" href="#top"><img src="../media/svg/page_up.svg"
                    alt="Page Up Hellper Javiddo"></a>
        </div>
        <div class="page_up"><a style="transition: 10s; margin: auto;" href="#top"><img src="../media/svg/page_up.svg"
                    alt="Page Up Hellper Javiddo"></a>
        </div>
        <div class="red_line"></div>
        <div class="footer">

            <div class="footer_left">
                <a class="left_nav_bar" href="https://www.javiddo.com/p/catalog">
                    <img src="../media/svg/LeftArrow.svg" alt="Back Page Hellper Javiddo Spare Parts">
                </a>
                <a class="left_nav_bar" href="https://www.javiddo.com/p/catalog">
                    <img src="../media/svg/HomePage.svg" alt="Home Page Hellper Javiddo Spare Parts">
                </a>
                <a class="left_nav_bar" href="./Pages/book.html">
                    <img src="../media/svg/Book.svg" alt="Book Page Hellper Javiddo Spare Parts">
                </a>
            </div>
            <div class="footer_center">
                <button class="toggle-button" onclick="toggleTheme()">
                    <img id="light-image" class="theme-image light-theme" src="../media/image/Moon.png"
                        alt="Light Image">
                    <img id="dark-image" class="theme-image dark-theme" src="../media/image/Sun.png" alt="Dark Image">
                </button>
            </div>

            <div class="footer_right">
                <a href="./Pages/tour.html" class="right_nav_bar">
                    <img style="width: 27px;" src="../media/svg/360-degrees.svg"
                        alt="360 Room Tour Javiddo Hellper Spare Part">
                </a>
                <a href="https://www.javiddo.com/contact" class="right_nav_bar">
                    <img src="../media/svg/Phone.svg" alt="Contact Us Javiddo Hellper Spare Part">
                </a>

                <a style="cursor: pointer;" onclick="convertExcelToPDF()" class="right_nav_bar">
                    <img src="../media/svg/Download.svg" alt="Download Javiddo Hellper Spare Part">
                </a>
            </div>
        </div>

        <!-- <script src="../script.js"></script> -->
        <script>
            function convertExcelToPDF() {
                var excelFilePath = './DataBase/TestDataBase.xlsx';

                var reader = new FileReader();

                reader.onload = function (e) {
                    var data = new Uint8Array(e.target.result);
                    var workbook = XLSX.read(data, { type: 'array' });
                    var firstSheetName = workbook.SheetNames[0];
                    var ws = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(ws, { header: 1 });

                    // Обработка данных
                    var cleanedData = removeEmptyCells(jsonData);

                    // Генерация PDF
                    var pdfDoc = {
                        content: [
                            {
                                table: {
                                    headerRows: 1,
                                    body: cleanedData.map(row => row.map(cell => {
                                        return {
                                            text: cell,
                                            alignment: 'center', // Выравнивание текста по горизонтали
                                            lineHeight: 1.2, // Высота строки (множитель)
                                            margin: [5, 10],
                                            noWrap: true // Отступы вокруг текста в ячейке (вертикальный отступ больше)
                                        };
                                    })),
                                    widths: Array(cleanedData[0].length).fill('*'), // Установим ширину колонок по содержимому
                                    alignment: 'center' // Центрирование таблицы
                                },
                                layout: 'lightHorizontalLines' // Сохраняем горизонтальные линии
                            }
                        ],
                        background: createWatermarkBase64(),
                        pageMargins: [50, 50, 50, 50],
                        pageSize: 'A4',
                        pageOrientation: 'portrait',
                        pagePaddings: [0, 30],
                    };

                    pdfMake.createPdf(pdfDoc).download("converted_data.pdf");
                };

                fetch(excelFilePath)
                    .then(response => response.arrayBuffer())
                    .then(buffer => {
                        reader.readAsArrayBuffer(new Blob([buffer]));
                    })
                    .catch(error => console.error('Error fetching the Excel file:', error));
            }

            function removeEmptyCells(jsonData) {
                // Удаляем пустые ячейки из каждой строки данных
                var cleanedData = jsonData.map(row => row.filter(cell => cell !== undefined && cell !== null && cell !== ''));

                // Находим максимальное количество ячеек в строках после удаления пустых
                var maxCells = Math.max(...cleanedData.map(row => row.length));

                // Добавляем недостающие ячейки в каждую строку после удаления пустых
                cleanedData = cleanedData.map(row => {
                    var diff = maxCells - row.length;
                    if (diff > 0) {
                        return row.concat(Array(diff).fill(''));
                    }
                    return row;
                });

                return cleanedData;
            }

            function createWatermarkBase64() {
                // Замените 'path/to/your/image.png' на путь к вашему изображению в формате PNG
                var imagePath = './media/svg/WaterMark.svg';

                // Преобразование изображения в base64
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                var img = new Image();

                img.src = imagePath;
                canvas.width = img.width;
                canvas.height = img.height;

                ctx.drawImage(img, 0, 0, img.width, img.height);

                var dataURL = canvas.toDataURL('image/png');

                return { image: dataURL, width: 500, height: 500, absolutePosition: { x: 50, y: 250 }, opacity: 0.1 };
            }




            // Путь к вашему Excel-файлу
            var excelFilePath = '../DataBase/TestDataBase.xlsx';

            var req = new XMLHttpRequest();
            req.open('GET', excelFilePath, true);
            req.responseType = 'arraybuffer';

            req.onload = function (e) {
                var data = new Uint8Array(req.response);
                var workbook = XLSX.read(data, { type: 'array' });
                var jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                document.getElementById('table-container').innerHTML = jsonToTable(jsonData);
            };

            req.send();

            function jsonToTable(jsonData) {
                var table = '<table>';
                table += '<tr>';
                for (var key in jsonData[0]) {
                    table += '<th>' + key + '</th>';
                }
                table += '</tr>';

                for (var i = 0; i < jsonData.length; i++) {
                    table += '<tr>';
                    for (var key in jsonData[i]) {
                        table += '<td>' + jsonData[i][key] + '</td>';
                    }
                    table += '</tr>';
                }
                table += '</table>';

                return table;
            }
        </script>
    </div>
</body>

</html>